import sys, os.path
sys.path.append(os.path.join(os.path.dirname(__file__), '../../src'))

import pytest
from src.common import constant
from test.fake_conn_tool import FakeConnTool
from src.models.project_weekcommit_model import ProjectWeekCommitModel

class TestWeekCommitModel():
    
    @classmethod
    def setup_class(self):
        self.model = ProjectWeekCommitModel(FakeConnTool())

    def test_constructor(self):
        assert self.model._db != None
        assert self.model._uid == constant.TEST_UID

    def test_construct_week_dict(self):
        res = self.model._ProjectWeekCommitModel__create_repo_week_dict()
        expect = {
            "start_time" : "2099/12/31",
            "end_time" : "1999/01/01",
            "commit_info" : [
                {
                    'week_day' : 'Monday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Tuesday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Wednesday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Thursday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Friday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Saturday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Sunday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                }
            ]
        }
        
        assert res == expect

    def test_get_weekcommit_fit_expectation(self):
        res = self.model.get_weekcommit(constant.TEST_PID1)
        expect = {
            "start_time" : "2020/12/28",
            "end_time" : "2021/01/03",
            "commit_info" : [
                {
                    'week_day' : 'Monday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 1,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Tuesday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Wednesday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Thursday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Friday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Saturday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 0,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                },
                {
                    'week_day' : 'Sunday',
                    '00' : 0,
                    '01' : 0,
                    '02' : 0,
                    '03' : 0,
                    '04' : 0,
                    '05' : 1,
                    '06' : 0,
                    '07' : 0,
                    '08' : 0,
                    '09' : 0,
                    '10' : 0,
                    '11' : 0,
                    '12' : 0,
                    '13' : 0,
                    '14' : 0,
                    '15' : 0,
                    '16' : 0,
                    '17' : 0,
                    '18' : 0,
                    '19' : 0,
                    '20' : 0,
                    '21' : 0,
                    '22' : 0,
                    '23' : 0
                }
            ]
        }
        assert res == expect

    def test_get_compare_weekcommit_fit_expectation(self):
        res = self.model.get_compare_week_commit(constant.TEST_PID1, constant.TEST_PID_COMPARE)
        expect = {
            "start_time" : "2020/12/29",
            "end_time" : "2021/01/03",
            "commit_info" : [
                {
                    'pid' : 'testing_id',
                    'commit' : [
                        {
                            'week_day' : 'Monday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 1,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Tuesday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Wednesday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Thursday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Friday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Saturday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Sunday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 1,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        }
                    ]
                },
                {
                    'pid' : 'testing_id_compare',
                    'commit' : [
                        {
                            'week_day' : 'Monday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Tuesday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 2,
                            '10' : 0,
                            '11' : 1,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Wednesday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Thursday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Friday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Saturday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        },
                        {
                            'week_day' : 'Sunday',
                            '00' : 0,
                            '01' : 0,
                            '02' : 0,
                            '03' : 0,
                            '04' : 0,
                            '05' : 0,
                            '06' : 0,
                            '07' : 0,
                            '08' : 0,
                            '09' : 0,
                            '10' : 0,
                            '11' : 0,
                            '12' : 0,
                            '13' : 0,
                            '14' : 0,
                            '15' : 0,
                            '16' : 0,
                            '17' : 0,
                            '18' : 0,
                            '19' : 0,
                            '20' : 0,
                            '21' : 0,
                            '22' : 0,
                            '23' : 0
                        }
                    ]
                }
            ]
        }
        assert res == expect